# 测试指南

本文档提供详细的测试步骤，帮助验证新功能是否正常工作。

## 🧪 测试环境准备

### 1. 配置阿里云 API Key

如果还没有配置，请参考 [AI_SETUP.md](./docs/AI_SETUP.md) 完成配置。

确保在 GitHub Secrets 中已添加 `DASHSCOPE_API_KEY`。

### 2. 准备 GitHub Token（用于可视化脚本）

1. 访问 https://github.com/settings/tokens
2. 创建新的 Personal Access Token (classic)
3. 勾选 `repo` 权限
4. 复制生成的 token

## 🎯 功能 1：AI TODO 父任务关联测试

### 测试案例 1：基本父任务关联

**步骤**：

1. **创建父项目**
   - 进入仓库的 Issues 页面
   - 点击 "New issue"
   - 选择 "🤖 AI 快速创建 TODO"
   - 输入：
     ```
     开发博客系统，包括用户管理、文章管理、评论系统，预计1个月完成
     ```
   - 提交 Issue
   - 记录创建的 Issue 编号（假设为 #100）

2. **创建子任务（测试中文表达）**
   - 创建新 Issue，选择 "🤖 AI 快速创建 TODO"
   - 输入：
     ```
     实现用户注册和登录功能，属于 #100，后端开发，预计5天
     ```
   - 提交 Issue

3. **验证结果**
   - 查看新创建的 Issue（假设为 #101）
   - 应该看到：
     ```markdown
     ## 🔗 父任务
     
     **Parent Issue**: #100
     ```
   - 标签应该包含 `subtask`
   - 返回 #100，应该看到自动添加的子任务清单：
     ```markdown
     ## 📝 子任务列表
     
     - [ ] #101 - 实现用户注册和登录功能
     ```

### 测试案例 2：不同的表达方式

**步骤**：

1. **测试 "从属于" 表达**
   ```
   设计数据库表结构，从属于 #100，数据库模块，2天
   ```

2. **测试 "是...的子任务" 表达**
   ```
   编写API文档，是 #100 的子任务，文档工作，3天
   ```

3. **测试英文表达**
   ```
   Create frontend components, subtask of #100, frontend development, 4 days
   ```

4. **验证每个子任务**
   - 都应该有父任务标记
   - 都应该有 `subtask` 标签
   - #100 应该包含所有子任务的清单

### 测试案例 3：多层级任务

**步骤**：

1. **创建一级子任务**
   ```
   实现前端用户界面，属于 #100，前端开发，1周
   ```
   假设创建的是 #105

2. **创建二级子任务**
   ```
   设计登录页面，属于 #105，前端设计，2天
   ```

3. **验证层级关系**
   - #105 应该链接到 #100
   - 新的子任务应该链接到 #105
   - #100 应该包含 #105
   - #105 应该包含新的子任务

### 测试案例 4：使用 /todo 命令

**步骤**：

1. 在任何 Issue 下（比如 #100）添加评论：
   ```
   /todo 实现用户权限管理，属于 #100，后端，3天
   ```

2. 等待几秒，应该看到 AI 回复创建成功的消息

3. 验证新创建的 Issue 有正确的父任务关联

### 错误场景测试

**测试不存在的父任务**：
```
测试任务，属于 #99999，测试模块
```

**预期结果**：
- 应该创建 Issue
- 应该有父任务标记（#99999）
- 但父任务 #99999 不会被更新（因为不存在）
- 工作流日志应该有警告信息

## 📊 功能 2：可视化脚本测试

### 准备工作

1. **安装依赖**
   ```bash
   pip install requests
   ```

2. **设置环境变量**
   ```bash
   export GITHUB_TOKEN=your_token_here
   ```

### 测试案例 1：基本功能

**步骤**：

1. **运行脚本（使用便捷脚本）**
   ```bash
   cd /path/to/My_ToDo
   ./scripts/visualize.sh
   ```

2. **验证输出**
   - 应该显示 "正在获取 Issues..."
   - 应该显示 "正在分析 TODO 层级关系..."
   - 应该显示 "📊 TODO 层级结构可视化"
   - 应该有项目列表或任务列表
   - 应该有统计信息

3. **检查树状结构**
   - 父任务下应该缩进显示子任务
   - 使用 `├──` 和 `└──` 字符
   - 已完成的任务标记为 ✓
   - 未完成的任务标记为 ◯

4. **检查信息显示**
   - 每个任务应该显示类型（📦项目、⏰有期限、🔓开放性、📌子任务）
   - 应该显示优先级（🔴紧急、🟠重要、🟡中等、🟢低）
   - 如果有模块，应该显示 [模块名]
   - 如果有截止日期，应该显示 ⏰日期

### 测试案例 2：指定仓库

**步骤**：

```bash
python scripts/visualize_todos.py --owner niujiao1121 --repo My_ToDo
```

应该显示相同的输出。

### 测试案例 3：直接提供 Token

**步骤**：

```bash
python scripts/visualize_todos.py --owner niujiao1121 --repo My_ToDo --token your_token_here
```

应该正常工作，即使没有设置环境变量。

### 测试案例 4：检查统计信息

**验证**：

1. **总任务数统计**
   - 手动计算仓库中的 Issues 数量
   - 对比脚本显示的数量

2. **优先级统计**
   - 检查是否只统计未完成的任务
   - 检查分类是否正确

3. **即将到期任务**
   - 如果有7天内到期的任务，应该在列表中
   - 检查排序是否按日期

### 错误场景测试

**测试 1：没有 Token**
```bash
unset GITHUB_TOKEN
python scripts/visualize_todos.py
```

**预期结果**：显示错误信息，提示设置 GITHUB_TOKEN

**测试 2：无效的 Token**
```bash
export GITHUB_TOKEN=invalid_token
python scripts/visualize_todos.py
```

**预期结果**：显示 API 请求失败的错误

**测试 3：空仓库**
- 在一个没有 Issues 的仓库运行脚本
- 应该显示 "没有找到任何 Issue"

## 📋 完整测试清单

### AI 父任务关联
- [ ] 使用 "属于 #X" 创建子任务
- [ ] 使用 "从属于 #X" 创建子任务
- [ ] 使用 "是 #X 的子任务" 创建子任务
- [ ] 使用英文表达创建子任务
- [ ] 使用 /todo 命令创建子任务
- [ ] 创建多层级任务（孙任务）
- [ ] 验证父任务自动更新
- [ ] 验证 subtask 标签自动添加
- [ ] 测试不存在的父任务

### 可视化脚本
- [ ] 使用便捷脚本运行
- [ ] 使用 Python 脚本直接运行
- [ ] 指定仓库参数
- [ ] 提供 Token 参数
- [ ] 验证树状结构显示
- [ ] 验证优先级标记
- [ ] 验证截止日期显示
- [ ] 验证模块显示
- [ ] 验证统计信息
- [ ] 测试错误场景（无 Token）
- [ ] 测试错误场景（无效 Token）

## 🐛 问题报告

如果在测试过程中发现问题，请记录：

1. **问题描述**：详细描述遇到的问题
2. **复现步骤**：如何触发这个问题
3. **预期结果**：应该看到什么
4. **实际结果**：实际看到了什么
5. **环境信息**：
   - Python 版本
   - 操作系统
   - 仓库名称
6. **截图或日志**：如果可能，提供截图或日志

可以在 GitHub Issues 中报告问题，或直接在 PR 中评论。

## ✅ 测试通过标准

### AI 父任务关联
- ✅ 能正确识别多种中英文表达的父任务引用
- ✅ 新创建的子任务包含父任务标记
- ✅ 父任务自动添加子任务清单项
- ✅ 自动添加 subtask 标签
- ✅ 支持多层级任务结构
- ✅ 不存在的父任务不会导致失败

### 可视化脚本
- ✅ 能正确获取所有 Issues
- ✅ 能正确解析父子关系
- ✅ 树状结构显示清晰
- ✅ 信息展示完整（类型、优先级、模块、日期等）
- ✅ 统计信息准确
- ✅ 错误处理合理
- ✅ 使用简单，文档清晰

## 📝 测试报告模板

```markdown
## 测试报告

**测试日期**：YYYY-MM-DD
**测试人员**：[你的名字]
**仓库**：niujiao1121/My_ToDo

### AI 父任务关联测试

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 中文表达识别 | ✅/❌ | |
| 英文表达识别 | ✅/❌ | |
| /todo 命令 | ✅/❌ | |
| 多层级任务 | ✅/❌ | |
| 父任务更新 | ✅/❌ | |
| 标签添加 | ✅/❌ | |

### 可视化脚本测试

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 基本运行 | ✅/❌ | |
| 树状结构 | ✅/❌ | |
| 信息显示 | ✅/❌ | |
| 统计功能 | ✅/❌ | |
| 错误处理 | ✅/❌ | |

### 发现的问题

1. [问题描述]

### 总体评价

[总体评价和建议]
```

---

完成测试后，请在 PR 中报告结果。感谢您的测试！
