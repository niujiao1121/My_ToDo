# AI TODO 父任务关联示例

本文档展示如何使用 AI 快速创建功能自动建立 TODO 的父子关系。

## 📋 基本概念

当你创建一个子任务时，可以在描述中指定父任务编号，AI 会自动：
1. 识别父任务编号
2. 在新 TODO 中添加父任务引用
3. 在父任务中添加子任务清单项
4. 自动添加 `subtask` 标签

## 🎯 使用方法

### 方式一：在 AI 快速创建模板中指定

1. 创建新 Issue，选择 "🤖 AI 快速创建 TODO" 模板
2. 在描述中包含父任务编号

### 方式二：使用 /todo 命令

在任何 Issue 下评论：
```
/todo 任务描述，属于 #父任务编号
```

## 💡 支持的表达方式

AI 支持多种表达方式来指定父任务：

### 中文表达

1. **"属于 #编号"**
   ```
   实现用户登录功能，属于 #123，预计2天
   ```

2. **"从属于 #编号"**
   ```
   编写单元测试，从属于 #456，后端模块
   ```

3. **"是 #编号 的子任务"**
   ```
   设计数据库表结构，是 #789 的子任务，1天完成
   ```

4. **直接使用 #编号**
   ```
   优化查询性能，#234 项目，数据库优化，紧急
   ```

### 英文表达

1. **"parent #编号"**
   ```
   Implement user authentication, parent #123, backend, 3 days
   ```

2. **"subtask of #编号"**
   ```
   Design API endpoints, subtask of #456, backend, high priority
   ```

## 📝 完整示例

### 示例 1：创建项目和子任务

**步骤 1：创建父项目**

使用 AI 快速创建或手动创建：
```
开发用户管理系统，包括注册、登录、权限管理，预计2周
```

假设创建的 Issue 编号是 #100

**步骤 2：创建子任务**

```
实现用户注册 API，属于 #100，后端开发，预计2天
```

**AI 生成的 TODO 会包含**：
- 标题：`[TASK] 实现用户注册 API`
- 父任务标记：`**Parent Issue**: #100`
- 标签：`task-with-deadline`, `priority:medium`, `module:backend`, `subtask`

**父任务 #100 会自动更新**：
```markdown
## 📝 子任务列表

- [ ] #101 - 实现用户注册 API
```

### 示例 2：多层级任务

**创建一级子任务**：
```
实现前端用户界面，属于 #100，前端开发，5天
```
创建后得到 #102

**创建二级子任务**：
```
设计登录页面，属于 #102，前端设计，1天
```
创建后得到 #103

**结果**：
```
#100 (项目)
├── #101 (子任务)
└── #102 (子任务)
    └── #103 (孙任务)
```

### 示例 3：批量创建子任务

假设有项目 #200，可以快速创建多个子任务：

```
/todo 实现用户注册接口，属于 #200，后端，2天
```

```
/todo 实现用户登录接口，属于 #200，后端，2天
```

```
/todo 实现权限验证中间件，属于 #200，后端，1天
```

```
/todo 设计用户界面，属于 #200，前端，3天
```

这样会快速创建 4 个子任务，都关联到 #200。

### 示例 4：复杂项目结构

**大型项目**：创建 #300 - 电商平台开发

**模块 1 - 用户系统**：
```
开发用户系统模块，属于 #300，包括注册登录和个人中心，1周
```
创建 #301

**模块 1 的子任务**：
```
实现用户注册 API，属于 #301，后端，2天
实现用户登录 API，属于 #301，后端，2天
设计个人中心页面，属于 #301，前端，3天
```

**模块 2 - 商品管理**：
```
开发商品管理模块，属于 #300，包括商品展示和搜索，1周
```
创建 #305

**模块 2 的子任务**：
```
实现商品列表 API，属于 #305，后端，2天
实现商品搜索功能，属于 #305，后端，3天
设计商品详情页，属于 #305，前端，2天
```

**最终结构**：
```
#300 电商平台开发
├── #301 用户系统模块
│   ├── #302 实现用户注册 API
│   ├── #303 实现用户登录 API
│   └── #304 设计个人中心页面
└── #305 商品管理模块
    ├── #306 实现商品列表 API
    ├── #307 实现商品搜索功能
    └── #308 设计商品详情页
```

## 🔍 查看任务结构

创建完任务后，使用可视化脚本查看完整的树状结构：

```bash
python scripts/visualize_todos.py
```

**输出示例**：
```
🎯 项目列表
--------------------------------------------------------------------------------
└── ◯ #300 [PROJECT] 电商平台开发 (📦 项目, 🟠重要)
    ├── ◯ #301 [TASK] 用户系统模块 (⏰ 有期限, 🟡中等, [后端])
    │   ├── ◯ #302 [SUBTASK] 实现用户注册 API (📌 子任务, 🟡中等, [后端])
    │   ├── ◯ #303 [SUBTASK] 实现用户登录 API (📌 子任务, 🟡中等, [后端])
    │   └── ◯ #304 [SUBTASK] 设计个人中心页面 (📌 子任务, 🟡中等, [前端])
    └── ◯ #305 [TASK] 商品管理模块 (⏰ 有期限, 🟡中等, [后端])
        ├── ◯ #306 [SUBTASK] 实现商品列表 API (📌 子任务, 🟡中等, [后端])
        ├── ◯ #307 [SUBTASK] 实现商品搜索功能 (📌 子任务, 🟡中等, [后端])
        └── ◯ #308 [SUBTASK] 设计商品详情页 (📌 子任务, 🟡中等, [前端])
```

## ⚠️ 注意事项

1. **父任务必须存在**
   - 确保父任务的 Issue 编号是有效的
   - 如果父任务不存在，会创建子任务但不会建立关联

2. **编号格式**
   - 使用 `#` 加数字，如 `#123`
   - 不要使用不存在的编号

3. **自动更新**
   - 父任务的子任务列表会自动更新
   - 如果父任务已有子任务列表，新子任务会追加到末尾
   - 如果父任务没有子任务列表，会自动创建该部分

4. **标签管理**
   - 指定父任务后会自动添加 `subtask` 标签
   - 其他标签（优先级、模块等）仍然正常识别

5. **多父任务**
   - 目前只支持一个父任务
   - 如果需要多个父任务，建议手动编辑 Issue

## 🎨 最佳实践

1. **先创建项目和主任务**
   - 从上到下创建任务层级
   - 先创建父任务，再创建子任务

2. **保持层级清晰**
   - 建议不超过 3-4 层
   - 每个父任务下的子任务数量保持在 3-10 个

3. **合理使用标签**
   - 子任务继承父任务的模块标签
   - 可以设置不同的优先级

4. **定期可视化检查**
   - 使用可视化脚本查看整体结构
   - 及时调整不合理的层级关系

5. **及时更新状态**
   - 完成子任务时关闭 Issue
   - 父任务的清单会自动标记为完成 ✓

## 📚 相关文档

- [AI 配置指南](../docs/AI_SETUP.md) - 如何配置 AI 功能
- [可视化脚本使用](../scripts/README.md) - 如何使用可视化脚本
- [TODO 结构说明](../docs/TODO_STRUCTURE.md) - 详细的树状结构说明

## 💬 反馈和建议

如果在使用过程中遇到问题或有改进建议，请：
1. 在仓库中创建 Issue
2. 或在 Discussions 中讨论
3. 欢迎提交 Pull Request 改进功能
